<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brettspiel mit Spielfiguren</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #e0f2fe;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 2rem;
            flex-direction: column;
            color: #1e40af;
        }

        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
            max-width: 1200px;
            width: 100%;
        }

        .board-container {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            background-color: #fff;
            padding: 2rem;
            border-radius: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border: 4px solid #3b82f6;
        }

        .game-board {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 0.5rem;
            padding: 1rem;
            width: 100%;
        }

        .board-square {
            width: 100%;
            padding-top: 100%;
            position: relative;
            border-radius: 0.75rem;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 0.875rem;
            text-align: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: transform 0.2s;
        }

        .board-square span {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .start-square { background-color: #34d399; color: #065f46; }
        .finish-square { background-color: #fcd34d; color: #92400e; }
        .weil-card { background-color: #f87171; color: #991b1b; }
        .dass-card { background-color: #60a5fa; color: #1e40af; }
        .wild-card { background-color: #7dd3fc; color: #075985; }

        .player-piece {
            position: absolute;
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: all 0.5s ease-in-out;
            z-index: 10;
        }
        
        /* Adjusting piece positions on a square */
        .player-piece.p0 { left: 10%; top: 10%; }
        .player-piece.p1 { right: 10%; top: 10%; }
        .player-piece.p2 { left: 10%; bottom: 10%; }
        .player-piece.p3 { right: 10%; bottom: 10%; }

        .game-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            margin-top: 2rem;
        }
        
        .game-status-text {
            font-size: 1.25rem;
            font-weight: bold;
        }

        .roll-dice-button {
            background-color: #10b981;
            color: white;
            padding: 1rem 2rem;
            border-radius: 0.75rem;
            font-size: 1.25rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .roll-dice-button:hover {
            background-color: #059669;
            transform: translateY(-2px);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }

        .modal-content {
            background-color: #fff;
            padding: 2rem;
            border-radius: 1rem;
            text-align: center;
            position: relative;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2);
            border: 4px solid #3b82f6;
        }

        .close-button {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            color: #9ca3af;
        }
        
        .win-trophy {
            width: 100px;
            height: auto;
            margin: 1rem auto;
        }

        .task-button {
            background-color: #3b82f6;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .task-button:hover {
            background-color: #2563eb;
        }

        .dice {
            width: 60px;
            height: 60px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            padding: 5px;
            margin-bottom: 1rem;
        }
        .dot {
            width: 10px;
            height: 10px;
            background-color: #3b82f6;
            border-radius: 50%;
            align-self: center;
            justify-self: center;
            opacity: 0;
            transition: opacity 0.1s ease-in;
        }
        .dice[data-roll="1"] .dot:nth-child(5) { opacity: 1; }
        .dice[data-roll="2"] .dot:nth-child(1), .dice[data-roll="2"] .dot:nth-child(9) { opacity: 1; }
        .dice[data-roll="3"] .dot:nth-child(1), .dice[data-roll="3"] .dot:nth-child(5), .dice[data-roll="3"] .dot:nth-child(9) { opacity: 1; }
        .dice[data-roll="4"] .dot:nth-child(1), .dice[data-roll="4"] .dot:nth-child(3), .dice[data-roll="4"] .dot:nth-child(7), .dice[data-roll="4"] .dot:nth-child(9) { opacity: 1; }
        .dice[data-roll="5"] .dot:nth-child(1), .dice[data-roll="5"] .dot:nth-child(3), .dice[data-roll="5"] .dot:nth-child(5), .dice[data-roll="5"] .dot:nth-child(7), .dice[data-roll="5"] .dot:nth-child(9) { opacity: 1; }
        .dice[data-roll="6"] .dot:nth-child(1), .dice[data-roll="6"] .dot:nth-child(3), .dice[data-roll="6"] .dot:nth-child(4), .dice[data-roll="6"] .dot:nth-child(6), .dice[data-roll="6"] .dot:nth-child(7), .dice[data-roll="6"] .dot:nth-child(9) { opacity: 1; }
        .hidden { display: none !important; }

        .player-selection-container {
            background-color: #fff;
            padding: 3rem;
            border-radius: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .player-selection-container .player-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .player-selection-container .player-buttons button {
            background-color: #60a5fa;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .player-selection-container .player-buttons button:hover {
            background-color: #3b82f6;
            transform: scale(1.05);
        }

        .task-button-group {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1rem;
        }
        
        .task-button-group .task-button {
            flex-grow: 1;
        }
        
        .solution-button {
            background-color: #bceaff;
            color: #3b82f6;
            font-weight: bold;
            border: 2px solid #3b82f6;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .solution-button:hover {
            background-color: #9cd6ff;
        }

        @keyframes win-animation {
            0%, 100% { transform: scale(1); box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2); }
            50% { transform: scale(1.05); box-shadow: 0 10px 50px -5px rgba(0, 0, 0, 0.4), 0 0 20px #fcd34d; }
        }

        .modal-content.win-effect {
            animation: win-animation 1s ease-in-out infinite;
        }
    </style>
</head>
<body class="bg-blue-50 flex flex-col items-center justify-center p-8">

    <div class="game-container">
        <h1 class="text-4xl font-extrabold mb-4 text-center text-blue-800">Brettspiel mit Figuren: Nebensätze</h1>
        <p class="text-lg text-blue-700 mb-8 text-center">Würfle, bewege deine Figur und löse Aufgaben. Denk an die Wortstellung!</p>
        
        <!-- Player selection screen -->
        <div id="playerSelection" class="player-selection-container">
            <h2 class="text-2xl font-bold">Wähle die Anzahl der Spieler:</h2>
            <div class="player-buttons">
                <button onclick="startGame(1)">1 Spieler</button>
                <button onclick="startGame(2)">2 Spieler</button>
                <button onclick="startGame(3)">3 Spieler</button>
                <button onclick="startGame(4)">4 Spieler</button>
            </div>
        </div>

        <!-- Main game board and controls (initially hidden) -->
        <div id="gameContent" class="hidden w-full flex flex-col items-center gap-8">
            <div class="board-container">
                <div class="game-board" id="gameBoard">
                    <!-- Board squares are programmatically generated -->
                </div>
                <!-- Player pieces added as separate elements for easier movement -->
                <div id="playerPieces"></div>
            </div>
    
            <div class="game-controls">
                <p id="gameMessage" class="text-xl font-bold text-center text-blue-700 mb-4"></p>
                <div id="diceVisual" class="dice">
                    <div class="dot"></div><div class="dot"></div><div class="dot"></div>
                    <div class="dot"></div><div class="dot"></div><div class="dot"></div>
                    <div class="dot"></div><div class="dot"></div><div class="dot"></div>
                </div>
                <div class="game-status-text">
                    <span id="currentPlayer"></span>
                </div>
                <button id="rollDiceBtn" class="roll-dice-button">Würfeln!</button>
            </div>
        </div>
    </div>

    <!-- Modální okno pro zobrazení úkolu -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <span id="closeModal" class="close-button">&times;</span>
            <h3 id="taskTitle" class="text-2xl font-bold mb-4"></h3>
            <div id="winImage" class="hidden">
                 <img src="https://placehold.co/150x150/fcd34d/92400e?text=TROPHÄE" alt="Trophy" class="win-trophy" />
            </div>
            <p id="taskText" class="text-lg mb-4"></p>
            <div id="taskActions" class="flex flex-col items-center gap-4">
                <button id="showExampleBtn" class="task-button solution-button">Lösung anzeigen</button>
                <p id="taskExample" class="text-sm italic text-gray-500 mt-2 hidden"></p>
            </div>
            <div class="task-button-group mt-4">
                <button id="taskCompleteBtn" class="task-button" style="background-color: #22c55e;">Aufgabe gelöst!</button>
                <button id="taskNotCompleteBtn" class="task-button" style="background-color: #ef4444;">Aufgabe nicht gelöst</button>
            </div>
        </div>
    </div>
    
    <script>
        const playerSelectionScreen = document.getElementById('playerSelection');
        const gameContent = document.getElementById('gameContent');
        const gameBoard = document.getElementById('gameBoard');
        const playerPiecesContainer = document.getElementById('playerPieces');
        const rollDiceBtn = document.getElementById('rollDiceBtn');
        const currentPlayerText = document.getElementById('currentPlayer');
        const gameMessage = document.getElementById('gameMessage');
        const diceVisual = document.getElementById('diceVisual');
        const taskModal = document.getElementById('taskModal');
        const closeModalBtn = document.getElementById('closeModal');
        const taskTitle = document.getElementById('taskTitle');
        const taskText = document.getElementById('taskText');
        const taskExample = document.getElementById('taskExample');
        const showExampleBtn = document.getElementById('showExampleBtn');
        const taskCompleteBtn = document.getElementById('taskCompleteBtn');
        const taskNotCompleteBtn = document.getElementById('taskNotCompleteBtn');
        const winImage = document.getElementById('winImage');
        
        let currentDiceRoll = 0;
        
        // Hardcoded tasks for a stable game experience
        const tasks = [
            { type: 'weil', task: 'Ich bin glücklich. Ich habe meine Prüfung bestanden.', example: 'Ich bin glücklich, weil ich meine Prüfung bestanden habe.' },
            { type: 'dass', task: 'Ich denke. Du sprichst Deutsch.', example: 'Ich denke, dass du Deutsch sprichst.' },
            { type: 'weil', task: 'Wir gehen ins Kino. Wir lieben Filme.', example: 'Wir gehen ins Kino, weil wir Filme lieben.' },
            { type: 'weil', task: 'Er hat die Tür geschlossen. Er ist müde gewesen.', example: 'Er hat die Tür geschlossen, weil er müde gewesen ist.' },
            { type: 'weil', task: 'Ich rufe meine Freundin an. Ich habe eine Frage.', example: 'Ich rufe meine Freundin an, weil ich eine Frage habe.' },
            { type: 'dass', task: 'Ich weiß. Du kannst das lernen.', example: 'Ich weiß, dass du das lernen kannst.' },
            { type: 'weil', task: 'Der Hund bellt. Er sieht die Katze.', example: 'Der Hund bellt, weil er die Katze sieht.' },
            { type: 'dass', task: 'Es ist wichtig. Du lernst die Regeln.', example: 'Es ist wichtig, dass du die Regeln lernst.' },
            { type: 'weil', task: 'Wir haben gegessen. Wir sind müde gewesen.', example: 'Wir haben gegessen, weil wir müde gewesen sind.' },
            { type: 'weil', task: 'Ich kaufe das ein. Ich muss es haben.', example: 'Ich kaufe das ein, weil ich es haben muss.' },
            { type: 'dass', task: 'Es ist gut. Wir wollen nach Hause gehen.', example: 'Es ist gut, dass wir nach Hause gehen wollen.' },
            { type: 'weil', task: 'Ich kaufe ein Buch. Ich lese gern.', example: 'Ich kaufe ein Buch, weil ich gern lese.' },
            { type: 'dass', task: 'Ich weiß. Du bist eingeschlafen.', example: 'Ich weiß, dass du eingeschlafen bist.' },
            { type: 'weil', task: 'Der Zug fährt ab. Es ist spät.', example: 'Der Zug fährt ab, weil es spät ist.' },
            { type: 'dass', task: 'Sie hat mir gesagt. Sie muss jetzt arbeiten.', example: 'Sie hat mir gesagt, dass sie jetzt arbeiten muss.' },
            { type: 'weil', task: 'Wir bleiben zu Hause. Es regnet.', example: 'Wir bleiben zu Hause, weil es regnet.' },
            { type: 'dass', task: 'Es freut mich. Du hast gewonnen.', example: 'Es freut mich, dass du gewonnen hast.' }
        ];

        // Definition der Felder auf dem Spielbrett
        const boardLayout = [
            'start', 'weil', 'dass', 'weil', 'dass', 'wild',
            'dass', 'weil', 'dass', 'weil', 'dass', 'weil',
            'wild', 'dass', 'weil', 'dass', 'weil', 'wild',
            'dass', 'weil', 'dass', 'weil', 'dass', 'wild',
            'weil', 'dass', 'weil', 'dass', 'weil', 'dass', 'finish'
        ];
        
        // Spieler und Farben
        let players = [];
        let currentPlayerIndex = 0;
        const playerColors = ['#ef4444', '#3b82f6', '#10b981', '#f97316'];

        // Erstelle die Felder auf dem Brett
        function createBoard() {
            gameBoard.innerHTML = ''; // Clear existing board
            boardLayout.forEach((type, index) => {
                const square = document.createElement('div');
                square.classList.add('board-square');
                square.id = `square-${index}`;
                
                if (type === 'start') {
                    square.classList.add('start-square');
                    square.innerHTML = '<span>START</span>';
                } else if (type === 'finish') {
                    square.classList.add('finish-square');
                    square.innerHTML = '<span>ZIEL</span>';
                } else if (type === 'weil') {
                    square.classList.add('weil-card');
                    square.innerHTML = '<span>WEIL</span>';
                } else if (type === 'dass') {
                    square.classList.add('dass-card');
                    square.innerHTML = '<span>DASS</span>';
                } else if (type === 'wild') {
                    square.classList.add('wild-card');
                    square.innerHTML = '<span>?</span>';
                }

                gameBoard.appendChild(square);
            });
        }
        
        // Funktion zur Aktualisierung der Spielerposition
        function updatePlayerPosition(player) {
            const currentSquare = document.getElementById(`square-${player.position}`);
            const pieceElement = document.getElementById(player.id);
            const squareRect = currentSquare.getBoundingClientRect();
            const boardRect = gameBoard.getBoundingClientRect();

            pieceElement.style.left = `${squareRect.left - boardRect.left + (squareRect.width / 2)}px`;
            pieceElement.style.top = `${squareRect.top - boardRect.top + (squareRect.height / 2)}px`;
            pieceElement.classList.remove('p0', 'p1', 'p2', 'p3');
            pieceElement.classList.add(`p${players.findIndex(p => p.id === player.id)}`);
        }
        
        // Funktion zum Würfeln
        function rollDice() {
            rollDiceBtn.disabled = true;
            diceVisual.dataset.roll = ''; // Dice visual zurücksetzen
            currentDiceRoll = Math.floor(Math.random() * 6) + 1;
            
            // Dice Animation und zpráva
            setTimeout(() => {
                diceVisual.dataset.roll = currentDiceRoll;
                gameMessage.textContent = `Du hast eine ${currentDiceRoll} gewürfelt.`;
            }, 500);

            setTimeout(() => {
                const currentPlayer = players[currentPlayerIndex];
                
                // Zeige Karte basierend auf dem Feldtyp
                const nextPosition = currentPlayer.position + currentDiceRoll;
                const currentSquareType = boardLayout[nextPosition];

                if (currentSquareType === 'weil' || currentSquareType === 'dass' || currentSquareType === 'wild') {
                    // Filter tasks by type or get a random one for 'wild'
                    const filteredTasks = tasks.filter(t => currentSquareType === 'wild' || t.type === currentSquareType);
                    const randomTask = filteredTasks[Math.floor(Math.random() * filteredTasks.length)];
                    showModal('Aufgabe: Satzumwandlung', randomTask.task, randomTask.example);
                } else {
                    // Ziel oder leeres Feld, Bewegung ohne Aufgabe
                    handleTaskResult(true);
                }
            }, 1000); // Warten na das Ende der Animation
        }

        // Funktion zur Verarbeitung des Aufgabenergebnisses
        function handleTaskResult(taskCompleted) {
            const currentPlayer = players[currentPlayerIndex];
            
            if (taskCompleted) {
                let newPosition = currentPlayer.position + currentDiceRoll;
                if (newPosition >= boardLayout.length - 1) {
                    newPosition = boardLayout.length - 1;
                    showModal('Glückwunsch!', `Spieler ${currentPlayerIndex + 1} hat gewonnen!`, 'Du bist im Ziel!');
                    taskModal.querySelector('.modal-content').classList.add('win-effect');
                    rollDiceBtn.disabled = true;
                    rollDiceBtn.textContent = 'Spiel ist vorbei!';
                    currentPlayerText.textContent = `Spieler ${currentPlayerIndex + 1} hat gewonnen!`;
                }
                currentPlayer.position = newPosition;
            }
            
            updatePlayerPosition(currentPlayer);
            taskModal.style.display = 'none';
            taskModal.querySelector('.modal-content').classList.remove('win-effect');

            if (currentPlayer.position < boardLayout.length - 1) {
                currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
                currentPlayerText.textContent = `Spieler ${currentPlayerIndex + 1} ist am Zug`;
                rollDiceBtn.disabled = false;
            }
        }
        
        // Funktion zum Anzeigen des modalen Fensters
        function showModal(title, text, example = '') {
            taskTitle.textContent = title;
            taskText.textContent = text;
            taskExample.textContent = example;
            taskExample.classList.add('hidden');
            showExampleBtn.style.display = example && title !== 'Glückwunsch!' ? 'inline-block' : 'none';
            
            if (title === 'Glückwunsch!') {
                winImage.classList.remove('hidden');
                taskActions.classList.add('hidden');
                taskCompleteBtn.classList.add('hidden');
                taskNotCompleteBtn.classList.add('hidden');
                // Spustí konfety animaci
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 }
                });
            } else {
                winImage.classList.add('hidden');
                taskActions.classList.remove('hidden');
                taskCompleteBtn.classList.remove('hidden');
                taskNotCompleteBtn.classList.remove('hidden');
            }
            
            taskModal.style.display = 'flex';
        }

        // Schließe das modale Fenster
        closeModalBtn.addEventListener('click', () => {
            handleTaskResult(false);
        });

        showExampleBtn.addEventListener('click', () => {
            taskExample.classList.remove('hidden');
            showExampleBtn.style.display = 'inline-block';
        });

        taskCompleteBtn.addEventListener('click', () => {
            handleTaskResult(true);
        });

        taskNotCompleteBtn.addEventListener('click', () => {
            handleTaskResult(false);
        });

        window.addEventListener('click', (event) => {
            if (event.target === taskModal) {
                handleTaskResult(false);
            }
        });

        // Spiel starten
        function startGame(numPlayers) {
            playerSelectionScreen.classList.add('hidden');
            gameContent.classList.remove('hidden');

            players = [];
            for (let i = 0; i < numPlayers; i++) {
                players.push({ id: `player${i}`, position: 0 });
                const pieceElement = document.createElement('div');
                pieceElement.id = `player${i}`;
                pieceElement.classList.add('player-piece');
                pieceElement.style.backgroundColor = playerColors[i];
                playerPiecesContainer.appendChild(pieceElement);
            }

            createBoard();
            players.forEach(player => updatePlayerPosition(player));

            currentPlayerIndex = 0;
            currentPlayerText.textContent = `Spieler 1 ist am Zug`;
            rollDiceBtn.addEventListener('click', rollDice);
        }

    </script>
</body>
</html>
